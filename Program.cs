using System;
using System.IO;
using System.Collections;
using System.Collections.Generic;
using System.Numerics;
using System.Text;

namespace PixelPrime
{
	class Program
	{
		static void Main(string[] args)
		{
			//int width = Convert.ToInt32(Console.ReadLine());
			//int height = Convert.ToInt32(Console.ReadLine());
			//Python.PgmToNumber();
			
			BigInteger perfect;
			using (StreamReader sr = new StreamReader("perfectNumber.txt"))
			{
				String bigint = sr.ReadToEnd();
				BigInteger.TryParse(bigint, out perfect);
			}
			//Console.WriteLine(perfect);
			List<BigInteger> primes = new List<BigInteger>();
			Random rand = new Random();
			int log = (int)BigInteger.Log10(perfect)+1;
			Console.WriteLine("This number has {0} digits",log);

			try { File.Delete("possiblePrimes.txt"); }
			catch (DirectoryNotFoundException) { } 
			
			int solutions = 0;
			foreach (BigInteger i in Fluctuate(perfect,max:log/2, repeats:100)) 
			{ 
				if (RabinMiller.isPrime(i,1)) 
				{
					if (solutions == 0) File.WriteAllText("possiblePrimes.txt",String.Format("{0}\n",i));
					else File.AppendAllText("possiblePrimes.txt",String.Format("{0}\n",i));

					Console.WriteLine("Possible prime found");
					solutions++;
				}
			}
						
			/* 
			BigInteger prime;
			BigInteger.TryParse("777777005777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777700000077000077777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777077770077777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777077770777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777773777771777777777777777777777077770717777777777777777777777777777777777777777777777777777777777777777777777777777777777777777773777771777777777777777777777007770017777777777777777777777777777777777777777777777777777777777777777777777777777777777777777771777773777777777777777777777700077000077777777777777777777777777777777777777777777777777777777777777777777777777777777777777771177772177777777777777777777777777721717777777777777777777777777777777777777777777777777777777777777777777777777777777777777711177775377777777777777777777777777722727777777777777777777777777777777777777777777777777777777777777777777777777777777777777733377774577777777777777777777777777752737777777777777777777777777777777777777777777777777777777777777777777777777777777777777733317779477777777777777777777777777722757777777777777777777777777777777777777777777777777777777777777777777777777777777777777333327719477777777777777777777777771155759949444549444455555555555555554555555555525555555555555555555555555555555554455555555233337719917777777777777777777777771155156666666696699699999999999999999499999999999449944944499994944499499449994449444494444523333719657777777777777777777777771594256666999666666669669666666666669966696969699999696999999999999966999996699999999966664953232749647777777777777777777777773444456666999666666696666666666666666696996666666999999999999699699966696969999969996966669643222169697777777777777777777777772444456666969666669996666666666666666699966699699999999944999999999999999999969999999996986642222269691177777777777777777777772444496666966666699999666666696666666999996999999999949444499999999999999999999999999966668696666666991577777777777777777777714445266666666666696999666666696666666999966999949999949949999996499999999999999999999966696699444669693617777777777777777777714495486666666666666696666666666666666669996966666699999944999966499699666999996696996688868946666666649613777777777777777777715445966696666868666666668888688888868666888888966886664996668896668888698888888988868888999644966449945644177777777777777777715445466999966666666946666666696666666646666666946666664999966699666666696696666968668888699669966649665869177777777777777777715544449499666699699996999999699966996949969996999969994949994999949999699999966666468886699649696669694869277777777777777777714444555554686649669966499694969496999969496449464969449999994495966644654666446996668688699949666869655669917777777777777777725449555554988696866696996699999966699699999696999666999649969964646669664696696666868888666644689668644686917777777777777777755549454444996696666646966996649969666649696666649696666649996686949866889696698866696888949944866866944686917777777777777777755549444449496668668696666666649666666649866866649666866649968666646686666696666886698886949645699666954986995777777777777777752254499999449666886649968668959666866959666666954666866959688669959886696946866609948086949645699666954986595777777777777777722254444494449688888649688688649886888949888886959886866949688869949888666946888809648006999644699666644688494777777777777777755544944999446688866966686696666666668999666886969666066966688669666868866668888806968006999644699666644988494777777777777777755559949999969686644446664456946454966994496686999666868966689686999946869696668886698006996644699666654988499777777777777777752256944999499686494946696949959949968644966688949666688999668686999896886699668886696006446655699866654988499777777777777777755548699999556868999449664694954566568654946608654668988645669608944488886944888086944006996644666866644988499177777777777777744496699999498888699446669949954999968654966888654666986654699866655988868655888806654006446645696666654488499177777777777777755559669699559888444554694922424549566654446688925668286954652666955588866945008869954006449845666666654488999177777777777777742544696666556888944559695455454449496654946688954666588655644686955488886955088889954006446845666866644488449177777777777777742254699666556888695259894955954449496654946688955688586954644666955988866955088666954006496644966866644488446277777777777777742254689699456888694544699954944449498654946688954688589644844666944988866944888686944008888925666888954988449277777777777777745596969999448888888999868886699888888649688868644088880699808888649888888699888808996006499999649999664988999377777777777777745446000008996880000899000000899000000699000000699000000699000008999000006999000086969006496964699466666568449377777777777777745556000008466880000846000000849000000899000000669000000664000000694000008994000008964006996965664966664468669377777777777777745546699996448888888856088888846888668849866880844868888664888888969888880664888888664886688664669966894498899927777777777777795469444496948684499696899996649699996044699996844644996044696966844999996845469968845999968845466888895998849927777777777777752244454999549999949954944944925944946855944944955444449644949449955449449945449449952549496945494996845490899927777777777777352549946644556949669424696864955696669655696899954699694645666699944998699994998699944966666944969666845498854657777777777777155499499999556996866954666866954666866645668866944668866845666869644968869644968666644668666944686666855498854927777777777777152468694499556998886955668886655668886645668886644688886645688866644988866644688866644688666644686666855568859927777777777777345468899944556698888644668886644668886644688886644686886844688686694688866694688866694688866644668666855598859927777777377777365488886894449868888649668888644888888644686886645888806844688886645688886695966866695668888644688666855468859637777777417777166660888869559668868954668868654699888644686886644686686645988689694966669694966866694686868644688666855460859637777777937771580000086886554668866954668999644699666644689886644666686644686686694668666694966866694686888644688666855460059937777777843311380086088869559668866945668999644699666644669886645866986645696686695966666694966868894686888844808666854480859937777777066941796688888949454660884955668964644894488644666886699886686694696686695966666694968868844686888844688666854480859617777777008964266000889999454660889645668969644669988644666886644886986694666686695666666694966868694686888844888666855580859617777777000085366688008696954660889644668966644666688644696886644866686695666686645966686694966688644688888844688686855580659627777777000009668000006966696999999999988688899888688694688688894686888899666688869666688866688688866888880866688888899480846653777777800088888080008644669444445555569999655694449645644499655644499855945559645444496945444996945444966644999969644580659995233537000008000000000888869806885555566999644694449644694449645694449644944499945994499694999966644999688854999666655580649994549492000095668000000000869006805555568696644669499644694499645894499645608069945994496945999966644999686655999686655580949669999666008942669000000080899999444999466666699869499644699999699699996664668666866886888088888880066888000066688800899900896668666666008899946968084499499445545494586698866886666886886666868688866666888866666888686666688888868688868699996888644488649688866666844444999444694444444444444496968668886886996699499966699994996999644499699999946999496969944966968494996888644598959668888888888668686666886666966666668696800000888886999994644444449565444444946555555449854544444965554459406455449966455568429988888888866666666999686999999999999696868886888886686994944968644465496864946459686444644988944984980669468444669966944568959988888888666666666666666699999999999996699966000008686899899668669484989686946448698699646666899965000066488544866888944580946688888000666888888888888888888868666699996666000088698899099869869404989986998468966699846696669965000006468449888888949480949600888000966666666666666688888886666666969699888888860869096806806404860860698488800896848080069664000006468449866688944588459600000000999999999999999999999999999999999999494994944494999999994494999999999496966999949666699994888886468499688000444468946688888669999999999999999999999999999994944444444444444444999444449944444444444444444444444444444444444444444449999668999980946699999999999999999999999999999999999999999999999999944494444444994449444499999444444444444999499944444444499944444444444444499999996666999999999999999999999999999999999999999999999999999999444449444499999999999999999999999999999999999999999999999999944944444999999999999999499999999999999499999999994994444999999449444444994494444444444444444444944444999999999999999999999999999999944999",out prime);
			Console.WriteLine("Overall: {0}",BigIntegerExtensions.IsProbablePrime(prime,128));
			*/

		}
		static IEnumerable<BigInteger> Fluctuate(BigInteger number, int max = 5, int repeats = 3)
		{
			Random random = new Random();
			for (int strength = 1; strength <= max; strength++)
			{
				for (int i = 0; i < repeats; i++)
				{
					List<int> swapped = new List<int>();
					BigInteger fluctuated = number;
					for (int j = 0; j < strength; j++) {
						int n = random.Next(0,10);
						int digit = random.Next(0,(int)(BigInteger.Log10(number)+1));
						if (!swapped.Contains(digit))
						{
							int current = Digit(number,digit);
							fluctuated += (n-current)*BigInteger.Pow(new BigInteger(10),digit);
							swapped.Add(digit);
						}
					}
					yield return fluctuated;
				}
			}
		}
		static byte Digit(BigInteger n, int ord) { return (byte)((n / BigInteger.Pow(new BigInteger(10),ord))%10); }
	}
}
